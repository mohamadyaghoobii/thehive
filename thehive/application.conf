# TheHive Configuration File
# Version: 5.2.16
# Description: Main configuration file for TheHive

# Secret key - used by Play Framework
include "/etc/thehive/secret.conf"

# Database configuration - Cassandra
db.janusgraph {
  storage {
    backend = cql
    hostname = ["127.0.0.1"]
    cql {
      cluster-name = thp
      keyspace = thehive
      # Cassandra authentication (if enabled)
      # username = "thehive"
      # password = "your_password"
    }
  }
  
  # Search index configuration - Elasticsearch
  index.search {
    backend = elasticsearch
    hostname = ["127.0.0.1"]
    index-name = thehive
    # Elasticsearch authentication (if enabled)
    # elasticsearch {
    #   http {
    #     auth {
    #       type = basic
    #       basic {
    #         username = "elastic"
    #         password = "your_password"
    #       }
    #     }
    #   }
    # }
  }
}

# Attachment storage configuration
storage {
  provider = localfs
  localfs.location = /opt/thp/thehive/files
}

# HTTP configuration
play.http.context = "/"
application.baseUrl = "http://0.0.0.0:9000"

# Request size limits
play.http.parser.maxDiskBuffer = 1GB  # Max attachment size
play.http.parser.maxMemoryBuffer = 10M  # Max request size (excluding attachments)

# Cluster configuration (for multi-node setup)
# cluster {
#   mode = "local"
#   name = "thehive-cluster"
# }

# Cortex connector configuration
# Uncomment and configure after Cortex setup
play.modules.enabled += org.thp.thehive.connector.cortex.CortexModule

cortex {
  servers = [
    {
      name = "local-cortex"
      url = "http://127.0.0.1:9001"
      # Add your Cortex API key here after creating org-admin user
      # auth = {
      #   type = "bearer"
      #   key = "your-cortex-api-key-here"
      # }
      # Optional: HTTP client configuration
      # wsConfig {
      #   timeout.connection = 1 minute
      #   timeout.idle = 10 minutes
      #   timeout.request = 5 minutes
      # }
    }
  ]
}

# MISP connector (optional)
# play.modules.enabled += org.thp.thehive.connector.misp.MispModule
# 
# misp {
#   servers = [
#     {
#       name = "local-misp"
#       url = "http://localhost"
#       auth {
#         type = "key"
#         key = "your-misp-api-key"
#       }
#     }
#   ]
# }

# Logging configuration
logger.application = INFO
logger.org.thp = INFO
logger.org.janusgraph = WARN
logger.org.apache.cassandra = WARN
logger.org.elasticsearch = WARN

# Security headers
play.filters.headers.contentSecurityPolicy = "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:"

# CORS configuration (if needed for external access)
play.filters.enabled += "play.filters.cors.CORSFilter"
play.filters.cors {
  pathPrefixes = ["/api"]
  allowedOrigins = ["http://localhost:9000", "http://127.0.0.1:9000"]
  allowedHttpMethods = ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  allowedHttpHeaders = ["Accept", "Content-Type", "Origin", "X-Requested-With", "Authorization"]
}